<html>


<script>
/* so far copies Card, Deck, Table class defenitions of our old project but in javaScript. Except I don't think
there is array.shuffle() function in JS, so still need to implement that. Just to have some output, it draws
initial cards to the table and prints them in text view. */

function Card(shape, color, pattern, number) {
	this.shape = shape;
	this.color = color;
	this.pattern = pattern;
	this.number = number;
};

function Deck() {
	this.cards = new Array();
	for (var i = 1; i < 4; i++) {
		for (var j = 1; j < 4; j++) {
			for (var k = 1; k < 4; k++) {
				for (var l = 1; l < 4; l++) {
					this.cards.push(new Card(i,j,k,l));
				}
			}
		}
	}
};

function putCard(card, num) {
	document.body.innerHTML += (card.shape.toString() + card.color.toString() + card.pattern.toString() + card.number.toString());
	document.body.innerHTML += ("<input type='checkbox' id = 'check" + num + "' onclick = 'cardChosen(" + num + ")' //>");
};
function shuffle (deck) {

};
function drawTwelve (table) {
	for (var i = 0; i < 12; i++) {
		table.onTable.push(table.deck.cards.pop());
	}
};

function Table(deck) {
	this.deck = deck;
	this.onTable = new Array();
	drawTwelve(this);

};

function includes (array, element) {
    var answer = false;
    for (var i = 0; i < array.length; i++) {
        if (array[i]===element) answer = true;
    }
    return answer;
}

function isProperSet(array) {
	var valid = [3, 6, 9];
/*	var toCheck = new Array();
	var answer = true;
	for (temp in array) {
		var i = 0;
		for (p in temp) {
			toCheck[i] += temp.p;
			i++;
		}
	}
	for (temp2 in toCheck) {
		answer = answer && valid.includes(temp2);
	}*/
	var shape = 0;
	var color = 0;
	var pattern = 0;
	var number = 0;
	for (var i = 0; i < array.length; i++) {
		shape += array[i].shape;
        color += array[i].color;
        pattern += array[i].pattern;
        number += array[i].number;
	}
	var answer = ((includes(valid, shape))&&(includes(valid, color))&&(includes(valid, pattern))&&(includes(valid, number)));
	return answer;
}

function putTable (table) {
    for (var i = 0; i < table.onTable.length; i++) {
        putCard(table.onTable[i], i);
    }
    document.body.innerHTML += ("<input type='button' onclick = 'setChosen()' //>");
    
    
}
var deck = new Deck();
shuffle(deck);
var table = new Table(deck);
var currentSet = [];

function test() {
    putTable(table);     
}


function remove (array, index) {
    for (var i = index; i < array.length - 1; i++) {
        array[i] = array[i+1];
    }
    array.length--;
}


function cardChosen(number) {
   var bool = includes(currentSet, table.onTable[number]);
    if (bool) {
        var index = currentSet.indexOf(table.onTable[number]);
        if (index != -1) remove (currentSet, index);
        alert("You have unchosen card number: " + number);
       
    }
    else {
        if (currentSet.length < 3) {
             currentSet.push(table.onTable[number]);
             alert("You have chosen card number: " + number);
        }
        else {
            alert("Set includes only 3 cards!");
            document.getElementById("check" + number.toString()).checked = false;
        }
    }
}

function setChosen() {
    if (currentSet.length < 3) {
        alert("Please choose 3 cards!");
    }
    else {
        alert("You have chosen a Set!");
        if (isProperSet(currentSet)) {
            alert("That is a proper set indeed!");
            for (var i = 0; i < currentSet.length; i++) {
        /*  for (prop in currentSet[i]) {
               document.body.innerHTML += currentSet[i].prop;
        }*/
            
                document.body.innerHTML += currentSet[i].shape.toString() + currentSet[i].color.toString() + currentSet[i].pattern.toString() + currentSet[i].number.toString() + " ";
            }
            currentSet = [];
        }
        else {
            alert("That is not a proper set, please try again.");
             for (var i = 0; i < currentSet.length; i++) {
                document.body.innerHTML += currentSet[i].shape.toString() + currentSet[i].color.toString() + currentSet[i].pattern.toString() + currentSet[i].number.toString() + " ";
            }
            currentSet = [];
        }
    }
       // document.body.innerHTML += currentSet[0].shape;
}
</script> 
<body onload = "test()" >

</body>
</html>
